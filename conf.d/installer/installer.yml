name: OpenCity
version: 3.0.0
variables:
  - name: identifier
    value: 'OpenPABase::getCurrentSiteaccessIdentifier'
  - name: root_node
    value: 'ini(NodeSettings,RootNode,content.ini)'
  - name: media_root_node
    value: 'ini(NodeSettings,MediaRootNode,content.ini)'
  - name: anonymous_user
    value: 'ini(UserSettings,AnonymousUserID,site.ini)'
  - name: members
    value: 11
  - name: members_node
    value: 12
  - name: members_path_string
    value: /1/5/12/
  - name: users
    value: 5
  - name: recaptcha_public
    value: env(RECAPTCHA_PUBLIC)
  - name: recaptcha_private
    value: env(RECAPTCHA_PRIVATE)
  - name: recaptcha_v3_public
    value: env(RECAPTCHA_V3_PUBLIC)
  - name: recaptcha_v3_private
    value: env(RECAPTCHA_V3_PRIVATE)
  - name: section_standard
    value: 1
  - name: section_media
    value: 3
  - name: content_Files_node
    value: 52
  - name: content_Files_path_string
    value: /1/43/52/
  - name: content_Images_node
    value: 51
  - name: content_Images_path_string
    value: /1/43/51/
  - name: content_Multimedia_node
    value: 53
  - name: content_Multimedia_path_string
    value: /1/43/53/
  - name: check_eztags_sequence
    value: env(CHECK_EZTAGS_SEQUENCE)
steps:
  - type: sql
    identifier: alter_contentobject_date_interger_type

  - type: sql_copy_from_tsv
    identifier: eztags
    table: eztags
    condition: $is_install_from_scratch
  - type: sql_copy_from_tsv
    identifier: eztags_keyword
    table: eztags_keyword
    condition: $is_install_from_scratch
  - type: sql
    identifier: check_eztags_sequence
    condition: $is_install_from_scratch

  - type: states
    identifiers:
      - moderation
      - privacy
      - albotelematico
      - concorso

  - type: sections
    identifiers:
      - intranet
      - restricted
      - oggetti_scaduti

  - type: tagtree_csv
    identifiers:
      - costi_e_prezzi
      - data_themes_eurovocs
      - dataset
      - documenti
      - esito_servizi_al_cittadino
      - eventi
      - licenze
      - lingue_in_cui_e_disponibile_un_servizio_un_evento
      - luoghi
      - organizzazione
      - parole_chiave_generali
      - persone
      - servizi_pubblici
      - tipi_di_notizia

  - type: php_callable
    identifier: 'OpenPAComuniItaliani::import'
    condition: $is_install_from_scratch

  - type: class_with_extra
    identifier: folder
  - type: class_with_extra
    identifier: pagina_sito
  - type: class_with_extra
    identifier: frontpage
  - type: class_with_extra
    identifier: image
  - type: class_with_extra
    identifier: link

  - type: images_from_url
    urls:
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/Consiglio-comunale.jpg
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/Giunta-comunale.jpg
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/Il-nuovo-modello-di-sito-web-comunale.png
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/competenze-digitali.png
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/comuni-2022.png
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/kit_architettura.png
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/opencityitalia.png
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/sindaco.jpg
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/viale-alberato.jpg
      - https://s3-eu-west-1.amazonaws.com/static.opencity.opencontent.it/installer/digitale.jpg
    parent: $content_Images_node
    attributes:
      license:
        - "Licenza sconosciuta"
      author: "Autore sconosciuto"

  - type: contenttree
    identifier: OpenCity
    parent: $root_node
  - type: contenttree
    identifier: Amministrazione
    parent: $contenttree_OpenCity_Amministrazione_node
  - type: contenttree
    identifier: Privacy
    parent: $contenttree_OpenCity_Privacy_node
  - type: contenttree
    identifier: Novita
    parent: $contenttree_OpenCity_Novita_node
  - type: contenttree
    identifier: Vivere-il-comune
    parent: $contenttree_OpenCity_Vivere-il-comune_node
  - type: contenttree
    identifier: Documenti-e-dati
    parent: $contenttree_OpenCity_Documenti-e-dati_node
  - type: contenttree
    identifier: Classificazioni
    parent: $contenttree_OpenCity_Classificazioni_node

  - type: class_with_extra
    identifier: topic
  - type: contenttree
    identifier: Argomenti
    parent: $contenttree_OpenCity_Argomenti_node
  - type: contenttree
    identifier: Argomenti-Agricoltura-e-alimentazione
    parent: $contenttree_Argomenti_Agricoltura-e-alimentazione_node
  - type: contenttree
    identifier: Argomenti-Ambiente
    parent: $contenttree_Argomenti_Ambiente_node
  - type: contenttree
    identifier: Argomenti-Economia-e-finanze
    parent: $contenttree_Argomenti_Economia-e-finanze_node
  - type: contenttree
    identifier: Argomenti-Energia
    parent: $contenttree_Argomenti_Energia_node
  - type: contenttree
    identifier: Argomenti-Giustizia-sistema-giuridico
    parent: $contenttree_Argomenti_Giustizia-sistema-giuridico-e-sicurezza-pubblica_node
  - type: contenttree
    identifier: Argomenti-Governo-e-settore
    parent: $contenttree_Argomenti_Governo-e-settore-pubblico_node
  - type: contenttree
    identifier: Argomenti-Istruzione-cultura-e
    parent: $contenttree_Argomenti_Istruzione-cultura-e-sport_node
  - type: contenttree
    identifier: Argomenti-Mobilita-e-trasporti
    parent: $contenttree_Argomenti_Mobilita-e-trasporti_node
  - type: contenttree
    identifier: Argomenti-Popolazione-e-societa
    parent: $contenttree_Argomenti_Popolazione-e-societa_node
  - type: contenttree
    identifier: Argomenti-Salute
    parent: $contenttree_Argomenti_Salute_node
  - type: contenttree
    identifier: Argomenti-Scienza-e-tecnologia
    parent: $contenttree_Argomenti_Scienza-e-tecnologia_node
  - type: contenttree
    identifier: Argomenti-Tematiche-internazionali
    parent: $contenttree_Argomenti_Tematiche-internazionali_node
  - type: contenttree
    identifier: Argomenti-Territorio
    parent: $contenttree_Argomenti_Territorio_node

  - type: content
    identifier: Speciali
  - type: content
    identifier: Ruoli
  - type: content
    identifier: Banner
  - type: content
    identifier: Contenuti-obsoleti
  - type: content
    identifier: Dichiarazione-di-accessibilita

  - type: content
    identifier: Editor-Base
  - type: content
    identifier: Editor-Amministrazione
  - type: content
    identifier: Editor-Vivere-il-comune
  - type: content
    identifier: Editor-Novita
  - type: content
    identifier: Editor-Servizi
  - type: content
    identifier: Editor-Utenti
  - type: content
    identifier: Editor-Sito

  - type: class
    identifier: apps_container
  - type: class_with_extra
    identifier: user_group
  - type: class_with_extra
    identifier: user
    remove_extra: true
  - type: class_with_extra
    identifier: file
  - type: class_with_extra
    identifier: chart
  - type: class_with_extra
    identifier: banner
  - type: class_with_extra
    identifier: audio
  - type: class_with_extra
    identifier: channel
  - type: class_with_extra
    identifier: output
  - type: class_with_extra
    identifier: time_indexed_role
  - type: class_with_extra
    identifier: offer
  - type: class_with_extra
    identifier: article
  - type: class_with_extra
    identifier: public_person
  - type: class_with_extra
    identifier: organization
  - type: class_with_extra
    identifier: private_organization
  - type: class_with_extra
    identifier: event
  - type: class_with_extra
    identifier: public_service
  - type: class_with_extra
    identifier: document
  - type: class_with_extra
    identifier: place
  - type: class_with_extra
    identifier: online_contact_point
  - type: class_with_extra
    identifier: opening_hours_specification
  - type: class_with_extra
    identifier: dataset

  - type: class
    identifier: event_with_related
  - type: class
    identifier: organization_with_related
  - type: class
    identifier: opening_hours_specification_with_related
  - type: class
    identifier: image_with_related
  - type: class
    identifier: public_service_with_related

  - type: content
    identifier: Contatti-URP
  - type: content
    identifier: Palazzo-del-municipio
  - type: content
    identifier: Ufficio-relazioni-con-il-pubblico
  - type: content
    identifier: Consiglio-comunale
  - type: content
    identifier: Giunta-comunale
  - type: content
    identifier: Commissione
  - type: content
    identifier: PNRR-la-digitalizzazione-dei-servizi-comunali
  - type: content
    identifier: Con-il-nuovo-sito-web-il-comune-e-sempre-piu-digitale
  - type: content
    identifier: Kit-comuni
  - type: content
    identifier: Opencityitalia
  - type: content
    identifier: Architettura-e-contenuti

  - type: class_with_extra
    identifier: homepage
  - type: content
    identifier: OpenCity
    swap_with: $root_node
    remove_swapped: true
    update: 1

  - type: role
    identifier: Anonymous
    apply_to:
      - $anonymous_user
      - $members
  - type: role
    identifier: Members
    apply_to:
      - $members
      - $content_Editor-Base_object
  - type: role
    identifier: Editor-Base
    apply_to:
      - $content_Editor-Base_object
  - type: role
    identifier: Editor-Amministrazione
    apply_to:
      - $content_Editor-Amministrazione_object
  - type: role
    identifier: Editor-Classificazioni
    apply_to:
      - $content_Editor-Base_object
  - type: role
    identifier: Editor-Vivere-il-comune
    apply_to:
      - $content_Editor-Vivere-il-comune_object
  - type: role
    identifier: Editor-Novita
    apply_to:
      - $content_Editor-Novita_object
  - type: role
    identifier: Editor-Servizi
    apply_to:
      - $content_Editor-Servizi_object
  - type: role
    identifier: Editor-Utenti
    apply_to:
      - $content_Editor-Utenti_object
  - type: role
    identifier: Editor-Sito
    apply_to:
      - $content_Editor-Sito_object
  - type: role
    identifier: Editor-Backend
  - type: role
    identifier: Dashboard-Luoghi
    apply_to:
      - $content_Editor-Vivere-il-comune_object

  - type: openparecaptcha
    public: $recaptcha_public
    private: $recaptcha_private
    condition: $is_install_from_scratch
  - type: openparecaptcha_v3
    public: $recaptcha_v3_public
    private: $recaptcha_v3_private
    condition: $is_install_from_scratch

  - type: workflow
    identifier: Post-pubblicazione
    trigger:
      module: content
      function: publish
      connection_type: after
  - type: workflow
    identifier: Pre-pubblicazione
    trigger:
      module: content
      function: publish
      connection_type: before

  - type: change_state
    identifier: default
  - type: change_section
    identifier: default